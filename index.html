<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BD VIRAL LINK ZONE</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script src="https://ad.gigapub.tech/script?id=1096"></script>
    <script src="https://libtl.com/sdk.js" data-zone="10282897" data-sdk="show_10282897"></script>

    <style>
        :root {
            --bg-dark: #070b14;
            --card-bg: rgba(22, 29, 45, 0.8);
            --primary: #38bdf8;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --premium-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px 15px 100px;
            background-color: var(--bg-dark);
            color: var(--text-main);
            -webkit-font-smoothing: antialiased;
        }

        #welcomeHeader {
            text-align: center;
            font-size: 26px;
            font-weight: 800;
            background: var(--premium-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 25px;
        }

        .post {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .post img { width: 100%; border-radius: 12px; aspect-ratio: 16/9; object-fit: cover; }

        .progress-bar { height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress { height: 100%; background: var(--premium-gradient); transition: width 0.4s; }

        .buy-button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: var(--premium-gradient);
            color: white;
            font-weight: 700;
            cursor: pointer;
        }

        .buy-button.completed { background: #10b981; }
    </style>
</head>
<body>

<h2 id="welcomeHeader">BD VIRAL LINK ZONE</h2>

<div id="postList">
    <h3 style="color:var(--primary); font-size:14px;">âš¡ RECENT UPDATES</h3>
    <div id="postArea"></div>
</div>

<script>
const REQUIRED_ADS = 10;
const adsWatched = JSON.parse(localStorage.getItem('ads_progress') || '{}');

// --- Dual Ad Engine ---
async function showAnyAd() {
    return new Promise(async (resolve) => {
        let adShown = false;

        // 1. Try Monetag first (Fast response)
        try {
            if (typeof show_10282897 === 'function') {
                await show_10282897();
                adShown = true;
            }
        } catch (e) { console.log("Monetag failed, trying Giga..."); }

        if (adShown) return resolve(true);

        // 2. Try Giga.pub as Fallback
        try {
            if (typeof triggerAd === 'function') {
                triggerAd();
                adShown = true;
            }
        } catch (e) { console.log("Giga failed too."); }

        setTimeout(() => resolve(adShown), 2000);
    });
}

// --- Auto Ad on Open ---
window.onload = async () => {
    console.log("App opened, loading auto ad...");
    setTimeout(async () => {
        await showAnyAd();
    }, 3000); // à¦…à§à¦¯à¦¾à¦ª à¦“à¦ªà§‡à¦¨ à¦¹à¦“à§Ÿà¦¾à¦° à§© à¦¸à§‡à¦•à§‡à¦¨à§à¦¡ à¦ªà¦° à¦…à¦Ÿà§‹ à¦…à§à¦¯à¦¾à¦¡ à¦†à¦¸à¦¬à§‡
};

async function handleAction(id, link, btn) {
    let current = adsWatched[id] || 0;
    if(current >= REQUIRED_ADS) {
        window.open(link, '_blank');
        return;
    }
    
    const success = await showAnyAd();
    if(success) {
        current++;
        adsWatched[id] = current;
        localStorage.setItem('ads_progress', JSON.stringify(adsWatched));
        
        const progress = btn.parentElement.querySelector('.progress');
        if(progress) progress.style.width = `${(current/REQUIRED_ADS)*100}%`;
        
        if(current >= REQUIRED_ADS) {
            btn.textContent = "ðŸš€ DOWNLOAD NOW";
            btn.classList.add('completed');
        } else {
            btn.textContent = `ðŸ”“ UNLOCK VIDEO (${current}/${REQUIRED_ADS})`;
        }
    }
}

// --- Firebase & Initialization ---
const firebaseConfig = {
    apiKey: "AIzaSyDI2MyfbMFYd6HAkCdZ2A64uNhC16H5Ku4",
    databaseURL: "https://bdvideo-fc2e8-default-rtdb.firebaseio.com",
    projectId: "bdvideo-fc2e8",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

db.ref('posts').on('value', snap => {
    const data = snap.val();
    const postArea = document.getElementById('postArea');
    postArea.innerHTML = '';
    
    Object.entries(data || {}).forEach(([id, p]) => {
        const count = adsWatched[id] || 0;
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
            <img src="${p.imageLink}">
            <div style="font-weight:700; margin:10px 0;">${p.title}</div>
            <div class="progress-bar"><div class="progress" style="width:${(count/REQUIRED_ADS)*100}%"></div></div>
            <button class="buy-button" id="ps_${id}">${count >= REQUIRED_ADS ? 'ðŸš€ DOWNLOAD NOW' : `ðŸ”“ UNLOCK VIDEO (${count}/${REQUIRED_ADS})`}</button>
        `;
        postArea.appendChild(div);
        div.querySelector('button').onclick = (e) => handleAction(id, p.downloadLink, e.target);
    });
});
</script>
</body>
</html>
